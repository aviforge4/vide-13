<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skylite Video Player</title>

    <!-- Video.js Library and Styles -->
    <link href="https://vjs.zencdn.net/7.17.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.17.0/video.min.js" defer></script>

    <!-- Video.js Quality Levels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js" defer></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* General Styling for the Body */
        body {
            background-color: #fff9f9;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: white;
        }

        /* Video Container Styling */
        .video-js {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        /* Custom Control Bar Styling */
        .vjs-control-bar {
            display: flex !important;
            height: 50px !important;
            background-color: rgba(191, 168, 168, 0) !important;
            border-radius: 0 0 10px 10px;
        }

        .video-js .vjs-control-bar {
            display: none;
            width: 100%;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3em;
            background-color: #2b333f00;
            background-color: rgba(43, 51, 63, 0);
        }
        

        /* Control bar icon styling */
        .vjs-control, .vjs-next-button, .vjs-prev-button {
            font-size: 18px !important;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vjs-resolution-button {
            font-size: 18px !important;
            padding: 0; /* No padding to keep the button compact */
            cursor: pointer;
            margin: 0; /* Removed any margin that could interfere with positioning */
            position: absolute !important;
            top: 30% !important; /* Position the button close to the top edge */
            right: 20%; /* Position the button close to the right edge */
            z-index: 10; /* Ensure the button appears above other elements */
            margin-bottom: 0px !important;
        }

        .video-resolution-icon {
            top: 30% !important; /* Position the button close to the top edge */
            right: 20%; /* Position the button close to the right edge */
            z-index: 10; /* Ensure the button appears above other elements */
            margin-bottom: 0px !important;
        }

        .video-js {
            display: block;
            vertical-align: top;
            box-sizing: border-box;
            color: #fff;
            background-color: #000;
            position: relative; /* Ensures that absolutely positioned children are aligned to this container */
            padding: 0;
            font-size: 10px;
            line-height: 1;
            font-weight: normal;
            font-style: normal;
            font-family: Arial, Helvetica, sans-serif;
            word-break: initial;
            width: 100% !important;
            max-width: 100% !important;
            /* Aspect Ratio (9:16) */
            padding-top: calc(9 / 16 * 100%) !important; /* 16:9 Aspect ratio */
            border-radius: 0px !important;
        }

        /* Make the video itself fill the aspect ratio container */
        .video-js video {
            position: absolute !important;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important; /* Ensures the video covers the area while preserving aspect ratio */
        }



        #sub-title-icon {
            top: 0 !important;
            right: 0 !important;
        }


        .vjs-picture-in-picture-control {
            margin-right: 0% !important;
            right: 5% !important;
            position: absolute !important;
            font-size: 18px !important;
        }

        @media screen and (min-width: 240px) and (max-width: 768px) {
            .video-js .vjs-picture-in-picture-control {
                margin-right: 0% !important;
                right: 10% !important;
                position: absolute !important;
                font-size: 18px !important;            
            }
        }

        .video-js .vjs-fullscreen-control {
            font-size: 18px !important;
            margin-right: 0px !important;
            margin-left: auto !important;
        }

        /* Gear Icon (Resolution) Styling */
        .vjs-resolution-button {
            font-size: 22px !important;
            color: #ffffff !important;
            vertical-align: middle;
        }

        .quality-control-icon,
        .speed-control-icon {
            font-size: 22px !important;
            color: #333 !important;
            vertical-align: middle;
        }


        .quality-control-icon:hover,
        .speed-control-icon:hover {
            color: #333 !important;
        }
















        .vjs-menu-button-popup .vjs-menu .vjs-menu-content {
            background-color: #2B333F;
            background-color: rgba(43, 51, 63, 0.7);
            position: absolute;
            width: 100%;
            bottom: 1.5em;
            max-height: 15em;
        }

        .vjs-menu .vjs-menu-content {
            display: block;
            padding: 0;
            margin: 0;
            margin-left: 50% !important;
            font-family: Arial, Helvetica, sans-serif;
            overflow: auto;
            z-index: 100001;
            background-color: #ccc !important;
            border-radius: 10px !important;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3) !important; 
        }

        @media screen and (min-width: 240px) and (max-width: 768px) {
            .vjs-menu-button-popup .vjs-menu .vjs-menu-content {
                background-color: #2B333F;
                background-color: rgba(43, 51, 63, 0.7);
                position: absolute;
                width: 100%;
                bottom: -50px;
                max-height: 150px;
            }

            .vjs-menu .vjs-menu-content  {
                border-radius: 5px;
            }
        }

        .vjs-modal-dialog-content {
            background-color: #ffffff !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 16px !important;
        }

        .vjs-track-setting > select {
            margin-right: 1em;
            margin-bottom: 0.5em;
            border-radius: 5px !important;
            padding: 5px !important;
        }

        .vjs-text-track-settings fieldset span > select {
            max-width: 7.3em;
            border-radius: 5px !important;
            padding: 5px !important;
        }

        .vjs-text-track-settings legend {
            color: #000 !important;
            margin: 0 0 5px 0;
        }

        .vjs-track-settings-controls button {
            background-color: #ccc !important;
            background-image: linear-gradient(-180deg, #f3eded 88%, #73859f 100%) !important;
            color: #2B333F;
            cursor: pointer;
            border-radius: 5px;
            padding: 5px !important;

        }








































        .vjs-resolution-menu {
            display: none;
            position: absolute;
            background: #ffffff;
            color: black;
            list-style: none;
            padding: 0;
            margin: 0;
            border: none;
            outline: none;
            z-index: 999;
            border-radius: 8px;
            top: -60vh;
            width: 100vh;
            height: 60vh;
            max-width: 50vh;
            transition: all 0.3s ease;
            right: -20vh !important;
            left: auto;
        }

        @media screen and (min-width: 240px) and (max-width: 768px) {
            .vjs-resolution-menu {
                top: -20vh; /* Adjust the vertical position for smaller screens */
                width: 80vw; /* Set the width to a percentage of the viewport for responsiveness */
                height: 200px; /* Reduce the height slightly to fit smaller screens */
                max-width: 300px; /* Ensure the maximum width is within viewport limits */
                right: -10vw !important; /* Center the menu more effectively on smaller screens */
                left: auto; /* Keep the left alignment as auto to maintain consistency */
                bottom: -50px;
                overflow-y: scroll;
            }
        }


        .vjs-resolution-menu li {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            flex-direction: column;  /* Stack submenu vertically */
            align-items: flex-start; /* Align submenu to left */
            gap: 10px;
            transition: background 0.3s, color 0.3s;
            color: #181818;
            position: relative; /* Ensure submenus are positioned relative to li */
            width: 100% !important;
        }

        .vjs-resolution-menu li:hover {
            background-color: #f8f9fa;
            color: #333 !important;
            border-radius: 5px;
        }

        .vjs-resolution-menu.active {
            display: block;
        }

        .vjs-submenu {
            display: none;
            padding-left: 20px;
            margin-top: 10px;
            overflow-y: scroll;
            overflow-x: hidden;
            width: 100%;  /* Ensure submenu takes full width */
            position: relative;
            background-color: #f0f0f0;
            max-height: 200px; /* Limit height of submenu if needed */
            border-radius: 5px;
        }

        .vjs-submenu:hover {
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .vjs-submenu:hover li {
            background-color: #ffffff;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .vjs-submenu.active {
            display: block;
        }

        .vjs-submenu::-webkit-scrollbar {
            display: none;
        }


        .video-speed-control-container,
        .video-quality-control-container {
            white-space: nowrap;
            word-break: normal;
            width: fit-content;
        }

        .speed-control-icon,
        .quality-control-icon {
            margin-right: 5px;
        }

        .angle-down-video-speed,
        .angle-down-video-quality {
            margin-left: 5px;
        }





        .vjs-audio-button {
            display: none !important;
        }


























        /* Next and Previous Buttons Styling */
        .vjs-prev-button, .vjs-next-button {
            position: absolute !important;
            top: 50%;
            transform: translateY(-50%) !important;
            padding: 12px;
            width: 50px !important;
            height: 50px !important;
            color: white !important;
            font-size: 26px !important;
            cursor: pointer;
            z-index: 0 !important;
            transition: background 0.3s;
        }

        .vjs-prev-button { left: 15px; }
        .vjs-next-button { right: 15px; }

        /* Hide these buttons when the user is not interacting with the player */
        .video-js.vjs-user-inactive .vjs-prev-button,
        .video-js.vjs-user-inactive .vjs-next-button {
            display: none;
        }

        .video-js .vjs-big-play-button {
            display: none; /* Optional: hide the default big play button */
        }
    

        /* Center Play Button Styling */
        /* Center Play Button Styling */
        .video-js .vjs-play-control {
            position: absolute !important; /* Positioning inside the video container */
            top: 20% !important; /* Center vertically */
            left: 50% !important; /* Center horizontally */
            transform: translate(-50%, -50%) !important; /* Exact centering */
            cursor: pointer; /* Pointer cursor */
            z-index: 10000; /* Ensure it's above other elements like spinner */
            display: block; /* Ensure it's always visible */
            font-size: 30px;
            color: white;
            z-index: 0;
            background: #00b3ff00 !important;
            border: 2px solid white;        
            border: none !important;
            border-radius: 50%;
            padding: 10px !important;
            transition: background 0.3s;
            width: 50px;
            height: 50px;
        }
        
        .video-js .vjs-big-play-button {
            display: none; /* Optional: hide the default big play button */
        } 

        .vjs-play-control:hover {
            background: #00b3ff00 !important;
        }

        /* Progress Bar Customization */
        .vjs-progress-holder .vjs-play-progress {
            background-color: #00b4ff;
        }

        /* Volume icon styling */
        .vjs-volume-panel {
            display: none !important;
        }

        .video-js .vjs-progress-control {
            cursor: pointer;
            flex: auto;
            display: flex;
            align-items: center;
            min-width: 4em;
            touch-action: none;
            width: 100% !important;
            margin-left: 0px !important;
            left: 0 !important;
            position: absolute !important;
            margin-bottom: 5% !important;
        }

        .video-js .vjs-control {
            position: relative;
            text-align: center;
            margin: 0;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0% !important;
            margin-left: 0px;
            padding: 0;
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;
            padding-left: 0px;
            height: 0px !important;
            width: 4em;
            flex: none;
            
        }

        .vjs-progress-holder {
            margin-bottom: 1% !important;
        }

        
        











        

        /* Container for remaining time and total time display */
        .video-js .time-display-container {
            position: absolute;
            display: flex;
            align-items: center;
            left: 10%; /* Adjust this value to position the container */
            bottom: 10%; /* Adjust to place the container properly */
            color: #fff; /* Set text color to white to ensure visibility */
            font-size: 16px; /* Set a uniform font size */
            padding-bottom: 10px;
        }

        /* Styling for remaining time inside the container */
        .video-js .time-display-container .vjs-remaining-time {
            margin-right: 2px; /* Space between remaining time and the separator */
        }

        /* Styling for the separator between remaining time and total time */
        .video-js .time-display-container .vjs-time-separator {
            margin: 0 2px; /* Space around the separator */
        }

        .vjs-time-separator {
            margin-left: 5px !important;
            margin-right: 5px !important;
        }

        .vjs-remaining-time {
            margin-right: 5px !important;
        }

        .vjs-duration-display {
            margin-left: 5px !important;
        }

        /* Styling for total time inside the container */
        .video-js .time-display-container .vjs-duration-display {
            white-space: nowrap; /* Prevent wrapping */
        }

        /* Unified text styling */
        .video-js .time-display-container .vjs-remaining-time, 
        .video-js .time-display-container .vjs-duration-display,
        .video-js .time-display-container .vjs-time-separator {
            font-family: Arial, sans-serif;
        }

        @media screen and (min-width: 240px) and (max-width: 768px) {
            .video-js .time-display-container {
                position: absolute;
                display: flex;
                align-items: center;
                left: 15%; /* Adjust this value to position the container */
                bottom: 10%; /* Adjust to place the container properly */
                color: #fff; /* Set text color to white to ensure visibility */
                font-size: 14px; /* Set a uniform font size */
                padding-bottom: 10px;
            }
        }























        /* Autoplay Toggle Switch Styling */
        .vjs-autoplay-switch {
            position: absolute;
            top: 5%;
            right: 70px;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 18px;
            gap: 10px;
            color: #ffffff;
        }

        .vjs-autoplay-switch .switch {
            position: relative;
            display: inline-block;
            width: 44px; /* Adjusted width for better balance */
            height: 24px; /* Adjusted height for better balance */
        }

        .vjs-autoplay-switch .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .vjs-autoplay-switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #888;
            transition: 0.4s;
            border-radius: 12px;
        }

        .vjs-autoplay-switch .slider:before {
            position: absolute;
            content: "";
            height: 18px; /* Adjusted to fit within the slider */
            width: 18px; /* Adjusted to fit within the slider */
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .vjs-autoplay-switch input:checked + .slider {
            background-color: #00b4ff;
        }

        .vjs-autoplay-switch input:checked + .slider:before {
            transform: translateX(20px); /* Adjusted to align with new width */
        }

        .vjs-subtitle-button {
            display: none !important;
        }
        
    </style>
</head>
<body>
    <!-- Video Container -->
    <video id="skylite-video" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="500px"></video>

    <script>
        function skyliteVideoPlayer(playerId, videoSrc, videoList, adTagUrl) {
            var player = videojs(playerId, {
                controls: true,
                autoplay: false,
                preload: 'auto',
                fluid: true,
                playbackRates: [0.5, 1, 1.5, 2],
                controlBar: {
                    volumePanel: true,
                    fullscreenToggle: true,
                    remainingTimeDisplay: false, // Disable the default remaining time display
                    playbackRateMenuButton: false
                },
            });

            // Prevent default right-click context menu
            player.on('contextmenu', function(event) {
                event.preventDefault();
            });

            // Set the video source
            player.src({
                src: videoSrc,
                type: 'application/x-mpegURL'
            });

            // Add custom remaining time and total time display when the player is ready
            // Add custom remaining time and total time display when the player is ready
            player.ready(function () {
                // Create a container for remaining time and total time
                var timeDisplayContainer = player.controlBar.addChild('Component', {}, 0);
                timeDisplayContainer.addClass('time-display-container');

                // Add remaining time display first
                var remainingTimeDisplay = timeDisplayContainer.addChild('Component', {}, 0);
                remainingTimeDisplay.addClass('vjs-remaining-time');

                // Add separator between remaining time and total time
                var separator = timeDisplayContainer.addChild('Component', {}, 1);
                separator.addClass('vjs-time-separator');
                separator.el().innerHTML = ' / ';

                // Add total duration display after the remaining time
                var totalTimeDisplay = timeDisplayContainer.addChild('Component', {}, 2);
                totalTimeDisplay.addClass('vjs-duration-display');

                // Update remaining time and total time dynamically
                player.on('timeupdate', function () {
                    var remainingTime = player.remainingTime();
                    var totalTime = player.duration();
                    remainingTimeDisplay.el().innerHTML = '-' + formatTime(remainingTime);
                    totalTimeDisplay.el().innerHTML = formatTime(totalTime);
                });
            });

            // Function to format time in hh:mm:ss format
            function formatTime(seconds) {
                var date = new Date(null);
                date.setSeconds(seconds);
                var timeString = date.toISOString().substr(11, 8);
                return timeString.startsWith('00:') ? timeString.substr(3) : timeString;
            }

            // Create resolution button
            // Create resolution button
            var resolutionButton = document.createElement('button');
            resolutionButton.classList.add('vjs-resolution-button', 'vjs-control', 'vjs-button');
            resolutionButton.innerHTML = '<i class="fas fa-cog video-resolution-icon"></i>';
            player.controlBar.el().appendChild(resolutionButton);

            // Create resolution menu
            var resolutionMenu = document.createElement('ul');
            resolutionMenu.classList.add('vjs-resolution-menu');
            resolutionButton.appendChild(resolutionMenu);

            // Speed Control Item
            var speedControlItem = document.createElement('li'); 
            speedControlItem.innerHTML = '<div class="video-speed-control-container"><i class="fa-solid fa-sliders speed-control-icon"></i> Speed Control <i class="fa fa-angle-down angle-down-video-speed"></i></div>';
            resolutionMenu.appendChild(speedControlItem);

            // Quality Control Item
            var qualityControlItem = document.createElement('li');
            qualityControlItem.innerHTML = '<div class="video-quality-control-container"> <i class="fa-regular fa-circle-play quality-control-icon"></i> Quality Control <i class="fa fa-angle-down angle-down-video-quality"></i></div>';
            resolutionMenu.appendChild(qualityControlItem);

            // Speed Menu
            var speedMenu = document.createElement('ul');
            speedMenu.classList.add('vjs-submenu');
            speedMenu.id = 'video-speed';  // Fixed ID for speed menu
            var speeds = [0.5, 1, 1.5, 2];
            speeds.forEach(function(speed) {
                var speedOption = document.createElement('li');
                speedOption.innerHTML = `${speed}x`;
                speedOption.dataset.value = speed;

                // Set the initial tick mark on Normal speed (1x)
                if (speed === 1) {
                    speedOption.innerHTML = `${speed}x ✓`; // Mark 1x as the default speed
                }

                speedOption.addEventListener('click', function (event) {
                    event.stopPropagation();  // Prevent resolutionMenu from closing
                    // Remove tick mark from all options
                    speedMenu.querySelectorAll('li').forEach(function (item) {
                        item.innerHTML = item.dataset.value + 'x';
                    });

                    // Add tick mark to the selected option
                    speedOption.innerHTML = `${speed}x ✓`;

                    // Set the video playback speed
                    player.playbackRate(speed);
                });

                speedMenu.appendChild(speedOption);
            });
            speedControlItem.appendChild(speedMenu);

            // Quality Menu
            var qualityMenu = document.createElement('ul');
            qualityMenu.classList.add('vjs-submenu');
            qualityMenu.id = 'video-quality';  // Fixed ID for quality menu

            // Add "Auto" quality option
            var autoQualityOption = document.createElement('li');
            autoQualityOption.innerHTML = 'Auto';
            autoQualityOption.dataset.value = 'auto';
            autoQualityOption.addEventListener('click', function (event) {
                event.stopPropagation();  // Prevent resolutionMenu from closing
                // Remove tick mark from all options
                qualityMenu.querySelectorAll('li').forEach(function (item) {
                    item.innerHTML = item.dataset.value === 'auto' ? 'Auto' : item.dataset.value + 'p';
                });
                // Add tick mark to the selected option
                autoQualityOption.innerHTML = 'Auto ✓';

                // Enable all quality levels for auto mode
                var qualityLevels = player.qualityLevels();
                for (var i = 0; i < qualityLevels.length; i++) {
                    qualityLevels[i].enabled = true;
                }
            });
            qualityMenu.appendChild(autoQualityOption);
            qualityControlItem.appendChild(qualityMenu);

            var qualityLevels = player.qualityLevels();
            qualityLevels.on('addqualitylevel', function () {
                qualityMenu.innerHTML = ''; // Clear the menu and re-add "Auto" option
                qualityMenu.appendChild(autoQualityOption);

                // Set "Auto" as the default active option with the tick mark initially
                autoQualityOption.innerHTML = 'Auto ✓';

                for (var i = 0; i < qualityLevels.length; i++) {
                    let qualityLevel = qualityLevels[i];
                    let qualityOption = document.createElement('li');
                    qualityOption.innerHTML = `${qualityLevel.height ? qualityLevel.height + 'p' : 'Auto'}`;
                    qualityOption.dataset.value = qualityLevel.height ? `${qualityLevel.height}` : 'auto';

                    qualityOption.addEventListener('click', (function (levelIndex) {
                        return function (event) {
                            event.stopPropagation();  // Prevent resolutionMenu from closing
                            // Remove tick mark from all options
                            qualityMenu.querySelectorAll('li').forEach(function (item) {
                                item.innerHTML = item.dataset.value === 'auto' ? 'Auto' : item.dataset.value + 'p';
                            });

                            // Add tick mark to the selected option
                            qualityOption.innerHTML = `${qualityLevel.height}p ✓`;

                            // Enable only the selected quality level
                            for (var j = 0; j < qualityLevels.length; j++) {
                                qualityLevels[j].enabled = (j === levelIndex);
                            }
                        };
                    })(i));
                    qualityMenu.appendChild(qualityOption);
                }
            });

            // Toggle submenus and icons
            function toggleSubMenu(menu, controlItem) {
                const isActive = menu.classList.contains('active');
                
                // Close all other submenus
                document.querySelectorAll('.vjs-submenu').forEach(function (submenu) {
                    submenu.classList.remove('active');
                    submenu.parentElement.querySelector('.fa-angle-up')?.classList.replace('fa-angle-up', 'fa-angle-down');
                });

                // Toggle the clicked submenu and icon
                if (isActive) {
                    menu.classList.remove('active');
                    controlItem.querySelector('.fa-angle-up').classList.replace('fa-angle-up', 'fa-angle-down');
                } else {
                    menu.classList.add('active');
                    controlItem.querySelector('.fa-angle-down').classList.replace('fa-angle-down', 'fa-angle-up');
                }
            }

            // Speed Control toggle
            speedControlItem.addEventListener('click', function (event) {
                event.stopPropagation();  // Prevent resolutionMenu from closing
                toggleSubMenu(speedMenu, speedControlItem);
            });

            // Quality Control toggle
            qualityControlItem.addEventListener('click', function (event) {
                event.stopPropagation();  // Prevent resolutionMenu from closing
                toggleSubMenu(qualityMenu, qualityControlItem);
            });

            // Toggle the main resolution menu
            resolutionButton.addEventListener('click', function (event) {
                event.stopPropagation();  // Prevent document click handler from closing it immediately
                resolutionMenu.classList.toggle('active');
            });

            document.addEventListener('click', function (event) {
                if (!resolutionButton.contains(event.target) && !resolutionMenu.contains(event.target)) {
                    resolutionMenu.classList.remove('active');
                }
            });



            var currentVideoIndex = 0;
            function loadVideoByIndex(index) {
                if (index >= 0 && index < videoList.length) {
                    currentVideoIndex = index;
                    player.src({
                        src: videoList[index],
                        type: 'application/x-mpegURL'
                    });
                    player.play();
                }
            }

            var autoplay = false;

            // Autoplay Toggle Switch
            var autoplaySwitch = document.createElement('label');
            autoplaySwitch.classList.add('vjs-autoplay-switch');
            autoplaySwitch.innerHTML = `
                <div class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </div>
            `;
            autoplaySwitch.style.display = 'none'; // Hide initially
            player.el().appendChild(autoplaySwitch);

            autoplaySwitch.querySelector('input').addEventListener('change', function (event) {
                autoplay = event.target.checked;
            });

            player.on('ended', function () {
                if (autoplay) {
                    loadVideoByIndex((currentVideoIndex + 1) % videoList.length);
                }
            });

            var prevButton = document.createElement('button');
            prevButton.classList.add('vjs-prev-button', 'vjs-control', 'vjs-button');
            prevButton.innerHTML = '<i class="fa-solid fa-backward-step"></i>';
            player.el().appendChild(prevButton);

            prevButton.addEventListener('click', function () {
                loadVideoByIndex(currentVideoIndex - 1);
            });

            var nextButton = document.createElement('button');
            nextButton.classList.add('vjs-next-button', 'vjs-control', 'vjs-button');
            nextButton.innerHTML = '<i class="fa-solid fa-forward-step"></i>';
            player.el().appendChild(nextButton);

            nextButton.addEventListener('click', function () {
                loadVideoByIndex(currentVideoIndex + 1);
            });

            var miniPlayerButton = player.controlBar.getChild('PictureInPictureToggle');
            var fullscreenButton = player.controlBar.getChild('FullscreenToggle');

            if (miniPlayerButton && fullscreenButton) {
                resolutionButton.after(miniPlayerButton.el());
                miniPlayerButton.el().after(fullscreenButton.el());
            }

            loadVideoByIndex(currentVideoIndex);

            // Show autoplay switch when user interacts with the player
            function showAutoplaySwitch() {
                autoplaySwitch.style.display = 'block';
            }

            // Hide autoplay switch when no interaction is detected
            function hideAutoplaySwitch() {
                autoplaySwitch.style.display = 'none';
            }

            // Timeout for hiding autoplay switch after interaction
            let hideTimeout;
            function resetHideTimeout() {
                clearTimeout(hideTimeout);
                hideTimeout = setTimeout(hideAutoplaySwitch, 3000); // Hide after 3 seconds of inactivity
            }

            player.on('play', showAutoplaySwitch);
            player.on('pause', showAutoplaySwitch);
            player.on('mousemove', function () {
                showAutoplaySwitch();
                resetHideTimeout();
            });
            player.on('userinactive', hideAutoplaySwitch);

            // Create the subtitle button in the control bar
            var subtitleButton = document.createElement('button');
            subtitleButton.classList.add('vjs-subtitle-button', 'vjs-control', 'vjs-button');
            subtitleButton.innerHTML = '<i id="sub-title-icon" class="fa-regular fa-closed-captioning"></i>'; // Initial icon indicating subtitles are off
            player.controlBar.el().appendChild(subtitleButton);

            var subtitleTrackLoaded = false; // Flag to track if subtitles are loaded

            // Function to add subtitle tracks to the player
            function loadSubtitleTrack(label, srcLang, src) {
                if (!subtitleTrackLoaded) {
                    player.addRemoteTextTrack({
                        kind: 'subtitles',
                        label: label,
                        srclang: srcLang,
                        src: src,
                        default: true
                    }, false);
                    subtitleTrackLoaded = true; // Mark that subtitles are now loaded
                }
            }

            // Load subtitle tracks when the user clicks the subtitle button for the first time
            subtitleButton.addEventListener('click', function () {
                // Lazy load the subtitles on first click to improve initial load performance
                if (!subtitleTrackLoaded) {
                    loadSubtitleTrack('English', 'en', 'https://gist.githubusercontent.com/jimzimmerman/776cd9f344cf41691d732c5f13f8abf0/raw/fe6d9124e3e861b879ad711f925ee260acdf5f53/subtitles-en.vtt'); // Sample subtitle file
                }

                // Toggle subtitles on/off more efficiently
                var tracks = player.textTracks();
                for (var i = 0; i < tracks.length; i++) {
                    if (tracks[i].kind === 'subtitles') {
                        if (tracks[i].mode === 'showing') {
                            tracks[i].mode = 'disabled'; // Hide subtitles
                            subtitleButton.innerHTML = '<i class="fa-regular fa-closed-captioning"></i>'; // Update icon to indicate subtitles are off
                        } else {
                            tracks[i].mode = 'showing'; // Show subtitles
                            subtitleButton.innerHTML = '<i class="fa-solid fa-closed-captioning"></i>'; // Update icon to indicate subtitles are on
                        }
                    }
                }
            });

            // Variables to track touch positions
            // Variables to track touch positions
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            const TAP_THRESHOLD = 10; // Threshold for detecting tap, adjust as needed

            // Declare controlBarTimeout variable to avoid conflicts
            var controlBarTimeout; 

            // Function to show the control bar and elements
            function showControlBar() {
                // Show the video control bar if hidden
                player.controlBar.show();
                
                // Optionally, set a timeout to hide the controls after a few seconds of inactivity
                player.userActive(true); // Ensures controls are shown
            }

            // Function to update the play/pause icon based on video state
            function updatePlayPauseIcon() {
                if (player.paused()) {
                    player.controlBar.playToggle.controlText('Play');  // Show play icon
                } else {
                    player.controlBar.playToggle.controlText('Pause'); // Show pause icon
                }
            }

            // Add touchstart event listener to capture the initial touch position
            player.el().addEventListener('touchstart', function(event) {
                const touch = event.touches[0];
                touchStartX = touch.screenX;
                touchStartY = touch.screenY;

                // Show control bar when touch starts
                showControlBar();
            });

            // Add touchend event listener to detect if the movement qualifies as a tap
            player.el().addEventListener('touchend', function(event) {
                const touch = event.changedTouches[0];
                touchEndX = touch.screenX;
                touchEndY = touch.screenY;

                // Calculate the difference between start and end positions
                const deltaX = Math.abs(touchEndX - touchStartX);
                const deltaY = Math.abs(touchEndY - touchStartY);

                // Get the clicked element (target)
                const targetElement = event.target;

                // List of UI elements to ignore for the play/pause toggle
                const ignoredSelectors = [
                    '.vjs-volume-panel',    // Volume button
                    '.vjs-resolution-button', // Gear/settings button
                    '.vjs-fullscreen-control', // Fullscreen button
                    '.vjs-picture-in-picture-control', // Mini player button
                    '.vjs-subtitle-button', // Subtitle/captions button
                    '.vjs-autoplay-switch', // Autoplay toggle
                    '.vjs-control-bar',      // General control bar
                    '.vjs-play-control',     // Play button (if you have one)
                    '.vjs-mute-control',     // Mute button
                    '.vjs-progress-control'  // Progress bar
                ];

                // Check if the target element matches any of the ignored selectors
                const isIgnoredElement = ignoredSelectors.some(selector => targetElement.closest(selector));

                // Only toggle play/pause if it's a tap and not on any ignored UI element
                if (!isIgnoredElement && deltaX < TAP_THRESHOLD && deltaY < TAP_THRESHOLD) {
                    // Toggle play/pause only if it's a valid tap (not a swipe or on UI elements)
                    if (player.paused()) {
                        player.play();
                    } else {
                        player.pause();
                    }

                    // Update the play/pause icon
                    updatePlayPauseIcon();
                } else {
                    // If it's a swipe or unintentional touch, just show the control bar
                    showControlBar();
                }
            });

            // Update play/pause icon when the video state changes
            player.on('pause', updatePlayPauseIcon);
            player.on('play', updatePlayPauseIcon);

            // Ensure the control bar stays visible when there's any user interaction
            player.on('mousemove', showControlBar);
            player.on('touchmove', showControlBar);  // Ensure touch swipes also show the control bar

            // Optionally, hide the control bar after a period of inactivity
            function resetControlBarTimeout() {
                clearTimeout(controlBarTimeout);
                controlBarTimeout = setTimeout(() => player.userActive(false), 3000); // Hide after 3 seconds of inactivity
            }
            player.on('useractive', resetControlBarTimeout);



            // Adding keyboard event listeners for play/pause, forward, and backward
            document.addEventListener('keydown', function(event) {
                if (event.target.tagName.toLowerCase() !== 'input' && event.target.tagName.toLowerCase() !== 'textarea') {
                    switch (event.key) {
                        case ' ':
                            event.preventDefault();
                            if (player.paused()) {
                                player.play();
                            } else {
                                player.pause();
                            }
                            break;
                        case 'ArrowRight':
                            event.preventDefault();
                            player.currentTime(player.currentTime() + 10); // Forward 10 seconds
                            break;
                        case 'ArrowLeft':
                            event.preventDefault();
                            player.currentTime(player.currentTime() - 10); // Backward 10 seconds
                            break;
                        case 'n':
                            event.preventDefault();
                            loadVideoByIndex(currentVideoIndex + 1); // Next video
                            break;
                        case 'p':
                            event.preventDefault();
                            loadVideoByIndex(currentVideoIndex - 1); // Previous video
                            break;
                    }
                }
            });


            return player;
        }

        document.addEventListener('DOMContentLoaded', function() {
            var videoList = [
                'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
                'https://mtoczko.github.io/hls-test-streams/test-vtt/playlist.m3u8',  // HLS with VTT Subtitles
                'https://mtoczko.github.io/hls-test-streams/test-gap/playlist.m3u8',  // HLS Stream with subtitle gap testing
                'https://playertest.longtailvideo.com/adaptive/oceans_aes/oceans_aes.m3u8',  // AES encrypted stream with subtitles
                'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                'https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_ts/master.m3u8', // Video with built-in subtitles           
            ];

            skyliteVideoPlayer('skylite-video', videoList[0], videoList, 'https://example.com/adtag.m3u8');
        });
    </script>

</body>
</html>
